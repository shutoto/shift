<!DOCTYPE html>

<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚·ãƒ•ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#f0f2f5; --surface:#fff; --surface2:#f8f9fb; --border:#e2e6ea;
    --primary:#1a56db; --primary-light:#e8f0fe;
    --sat:#3b82f6; --sat-bg:#eff6ff; --sun:#ef4444; --sun-bg:#fef2f2;
    --text:#1e293b; --text2:#64748b; --text3:#94a3b8;
    --shadow:0 1px 3px rgba(0,0,0,0.08),0 4px 16px rgba(0,0,0,0.04);
    --radius:12px;
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;}

/* PIN */
.pin-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;background:linear-gradient(135deg,#1e3a8a,#1a56db,#2563eb);}
.pin-card{background:#fff;border-radius:20px;padding:40px 32px;width:100%;max-width:360px;box-shadow:0 20px 60px rgba(0,0,0,.25);text-align:center;}
.pin-logo{font-size:22px;font-weight:700;color:var(â€“primary);margin-bottom:6px;}
.pin-logo span{color:var(â€“text);font-weight:300;}
.pin-sub{font-size:13px;color:var(â€“text2);margin-bottom:28px;}
.pin-label{font-size:11px;font-weight:700;color:var(â€“text2);text-transform:uppercase;letter-spacing:.8px;margin-bottom:10px;}
.pin-input{width:100%;padding:14px;border-radius:10px;border:2px solid var(â€“border);font-family:â€˜IBM Plex Monoâ€™,monospace;font-size:22px;font-weight:700;text-align:center;letter-spacing:8px;outline:none;transition:all .15s;margin-bottom:14px;}
.pin-input:focus{border-color:var(â€“primary);box-shadow:0 0 0 3px rgba(26,86,219,.12);}
.pin-btn{width:100%;padding:14px;border-radius:10px;border:none;background:#1447c7;color:#fff;font-family:inherit;font-size:15px;font-weight:700;cursor:pointer;transition:all .15s;box-shadow:0 4px 14px rgba(20,71,199,.5);letter-spacing:.3px;}
.pin-btn:hover{background:#1038a8;box-shadow:0 6px 18px rgba(20,71,199,.6);}
.pin-btn:active{transform:scale(.97);}
.pin-error{margin-top:12px;font-size:13px;color:var(â€“sun);font-weight:500;min-height:20px;}
.pin-hint{margin-top:20px;font-size:11px;color:var(â€“text3);line-height:1.7;}

/* App shell */
.app{display:none;}
.app.show{display:block;}
.header{background:var(â€“surface);border-bottom:1px solid var(â€“border);padding:0 14px;position:sticky;top:0;z-index:100;box-shadow:0 1px 8px rgba(0,0,0,.06);}
.header-inner{max-width:1200px;margin:0 auto;display:flex;flex-direction:column;align-items:center;padding:8px 0 6px;gap:7px;}
.header-top{width:100%;display:flex;align-items:center;justify-content:space-between;}
.logo{font-size:15px;font-weight:700;color:var(â€“primary);white-space:nowrap;}
.logo span{color:var(â€“text);font-weight:300;}
.logo-role{font-size:10px;padding:2px 7px;border-radius:20px;font-weight:700;margin-left:5px;vertical-align:middle;}
.logo-role.emp{background:var(â€“primary-light);color:var(â€“primary);}
.logo-role.admin{background:#fef3c7;color:#92400e;}
.nav-tabs{display:flex;gap:2px;background:var(â€“bg);padding:3px;border-radius:10px;}
.nav-tab{padding:6px 20px;border-radius:7px;border:none;background:transparent;font-family:inherit;font-size:12px;font-weight:500;color:var(â€“text2);cursor:pointer;transition:all .15s;white-space:nowrap;}
.nav-tab.active{background:var(â€“surface);color:var(â€“primary);box-shadow:0 1px 4px rgba(0,0,0,.1);}
.header-right{display:flex;justify-content:flex-end;align-items:center;}
.logout-btn{padding:5px 12px;border-radius:7px;border:1.5px solid var(â€“border);background:transparent;font-family:inherit;font-size:12px;color:var(â€“text2);cursor:pointer;transition:all .15s;white-space:nowrap;}
.logout-btn:hover{color:var(â€“sun);border-color:var(â€“sun);background:#fef2f2;}
@media(min-width:600px){
.header-inner{flex-direction:row;justify-content:space-between;padding:0;height:54px;gap:8px;}
.header-top{width:auto;}
}

/* Period bar */
.period-bar{background:var(â€“surface);border-bottom:1px solid var(â€“border);padding:9px 20px;}
.period-bar-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.month-btn{width:30px;height:30px;border-radius:8px;border:1px solid var(â€“border);background:var(â€“surface);cursor:pointer;font-size:15px;display:flex;align-items:center;justify-content:center;transition:all .15s;color:var(â€“text2);}
.month-btn:hover{background:var(â€“primary-light);color:var(â€“primary);border-color:var(â€“primary);}
.period-label{font-size:15px;font-weight:700;color:var(â€“text);min-width:180px;}
.period-range{font-size:11px;color:var(â€“text2);background:var(â€“surface2);padding:3px 10px;border-radius:20px;border:1px solid var(â€“border);}

/* Main */
.main{max-width:1200px;margin:0 auto;padding:18px;}

/* Select card */
.select-card{background:var(â€“surface);border-radius:var(â€“radius);padding:16px 18px;margin-bottom:14px;box-shadow:var(â€“shadow);}
.card-title{font-size:11px;font-weight:700;color:var(â€“text2);text-transform:uppercase;letter-spacing:.8px;margin-bottom:10px;}
.emp-select-wrap{position:relative;display:inline-block;width:100%;max-width:280px;}
.emp-select{width:100%;padding:10px 34px 10px 13px;border-radius:10px;border:1.5px solid var(â€“border);background:var(â€“surface2);font-family:inherit;font-size:14px;font-weight:500;color:var(â€“text);cursor:pointer;appearance:none;-webkit-appearance:none;outline:none;transition:all .15s;}
.emp-select:focus{border-color:var(â€“primary);box-shadow:0 0 0 3px rgba(26,86,219,.12);}
.emp-select-arrow{position:absolute;right:11px;top:50%;transform:translateY(-50%);pointer-events:none;color:var(â€“text2);font-size:11px;}
.emp-status-row{display:flex;align-items:center;gap:8px;margin-top:9px;font-size:12px;color:var(â€“text2);}
.sdot-sm{width:8px;height:8px;border-radius:50%;background:var(â€“border);}
.sdot-sm.done{background:#10b981;} .sdot-sm.partial{background:#f59e0b;}

/* Shift card */
.shift-card{background:var(â€“surface);border-radius:var(â€“radius);padding:18px;box-shadow:var(â€“shadow);overflow-x:auto;}
.shift-card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px;}
.emp-badge{font-size:16px;font-weight:700;}
.save-btn{padding:10px 20px;border-radius:8px;border:none;background:#1447c7;color:#fff;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all .15s;display:flex;align-items:center;gap:5px;box-shadow:0 3px 10px rgba(20,71,199,.45);}
.save-btn:hover{background:#1038a8;box-shadow:0 4px 14px rgba(20,71,199,.55);} .save-btn:active{transform:scale(.97);} .save-btn:disabled{background:var(â€“text3);cursor:not-allowed;box-shadow:none;}
.sync-badge{font-size:11px;padding:3px 9px;border-radius:20px;font-weight:600;display:inline-flex;align-items:center;gap:3px;}
.sync-ok{background:#ecfdf5;color:#047857;} .sync-err{background:#fef2f2;color:#b91c1c;} .sync-loading{background:#eff6ff;color:var(â€“primary);}

/* Table */
.shift-table{width:100%;border-collapse:collapse;min-width:300px;}
.shift-table th{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(â€“text3);padding:7px 10px;border-bottom:1px solid var(â€“border);text-align:left;}
.shift-table td{padding:5px 10px;border-bottom:1px solid var(â€“border);vertical-align:middle;}
.shift-table tr:last-child td{border-bottom:none;}
.date-cell{display:flex;align-items:center;gap:7px;white-space:nowrap;}
.date-num{font-family:â€˜IBM Plex Monoâ€™,monospace;font-size:13px;font-weight:600;min-width:22px;}
.day-pill{font-size:10px;font-weight:700;padding:2px 6px;border-radius:4px;}
.is-sat .date-num{color:var(â€“sat);} .is-sat .day-pill{background:var(â€“sat-bg);color:var(â€“sat);}
.is-sun .date-num,.is-holi .date-num{color:var(â€“sun);} .is-sun .day-pill,.is-holi .day-pill{background:var(â€“sun-bg);color:var(â€“sun);}
.holi-name{font-size:10px;color:var(â€“sun);}

/* Shift buttons â€” generated dynamically from config */
.shift-sel{display:flex;gap:5px;flex-wrap:wrap;}
.s-btn{padding:5px 10px;border-radius:6px;border:1.5px solid var(â€“border);background:transparent;font-family:inherit;font-size:12px;font-weight:500;cursor:pointer;transition:all .12s;color:var(â€“text2);}
.s-btn:hover{border-color:var(â€“text);color:var(â€“text);}

/* Other text input */
.other-wrap{display:flex;align-items:center;gap:6px;margin-top:5px;}
.other-inp{padding:5px 9px;border-radius:6px;border:1.5px solid #8b5cf6;background:#f5f3ff;font-family:inherit;font-size:12px;color:#4c1d95;width:155px;outline:none;transition:all .15s;}
.other-inp:focus{box-shadow:0 0 0 3px rgba(139,92,246,.15);}

/* Summary */
.summary-bar{display:flex;gap:12px;margin-top:13px;padding-top:13px;border-top:1px solid var(â€“border);flex-wrap:wrap;}
.sum-item{display:flex;align-items:center;gap:4px;font-size:12px;}
.sum-count{font-family:â€˜IBM Plex Monoâ€™,monospace;font-weight:700;font-size:14px;}

/* Admin */
.admin-controls{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap;align-items:center;}
.action-btn{padding:8px 16px;border-radius:8px;border:1.5px solid var(â€“border);background:var(â€“surface);font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;color:var(â€“text);transition:all .15s;display:flex;align-items:center;gap:5px;}
.action-btn:hover{border-color:var(â€“primary);color:var(â€“primary);background:var(â€“primary-light);}
.admin-wrap{background:var(â€“surface);border-radius:var(â€“radius);box-shadow:var(â€“shadow);overflow-x:auto;}
.admin-tbl{width:100%;border-collapse:collapse;}
.admin-tbl th{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(â€“text3);padding:11px 13px;border-bottom:2px solid var(â€“border);text-align:center;background:var(â€“surface2);white-space:nowrap;}
.admin-tbl th:first-child{text-align:left;}
.admin-tbl td{padding:9px 13px;border-bottom:1px solid var(â€“border);text-align:center;font-size:13px;}
.admin-tbl td:first-child{text-align:left;font-weight:600;}
.admin-tbl tr:last-child td{border-bottom:none;}
.admin-tbl tr:hover td{background:var(â€“surface2);}
.badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:20px;font-size:12px;font-weight:600;}
.badge-total{background:var(â€“primary-light);color:var(â€“primary);}
.sdot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:5px;}
.sdot-done{background:#10b981;} .sdot-partial{background:#f59e0b;} .sdot-none{background:var(â€“border);}

/* Empty */
.empty{text-align:center;padding:44px 20px;color:var(â€“text3);}
.empty .ico{font-size:34px;margin-bottom:8px;}
.empty p{font-size:13px;line-height:1.7;}

/* Toast / Loading */
.toast{position:fixed;bottom:22px;right:20px;padding:11px 16px;background:#1e293b;color:#fff;border-radius:10px;font-size:13px;font-weight:500;box-shadow:0 8px 24px rgba(0,0,0,.2);opacity:0;transform:translateY(8px);transition:all .25s;z-index:999;pointer-events:none;max-width:270px;}
.toast.show{opacity:1;transform:translateY(0);}
.loading{display:none;position:fixed;inset:0;background:rgba(255,255,255,.75);z-index:200;align-items:center;justify-content:center;flex-direction:column;gap:10px;}
.loading.show{display:flex;}
.spinner{width:34px;height:34px;border:3px solid var(â€“border);border-top-color:var(â€“primary);border-radius:50%;animation:spin .7s linear infinite;}
.load-txt{font-size:13px;color:var(â€“text2);font-weight:500;}
@keyframes spin{to{transform:rotate(360deg);}}
@media(max-width:600px){.main{padding:10px;}.period-label{font-size:13px;min-width:140px;}}
</style>

</head>
<body>

<div class="pin-screen" id="pinScreen">
  <div class="pin-card">
    <div class="pin-logo">Shift<span>ç®¡ç†</span></div>
    <div class="pin-sub">ã‚¢ã‚¯ã‚»ã‚¹PINã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
    <div class="pin-label">PINã‚³ãƒ¼ãƒ‰</div>
    <input class="pin-input" type="password" id="pinInput" maxlength="8" placeholder="â€¢â€¢â€¢â€¢"
      onkeydown="if(event.key==='Enter')checkPin()">
    <button class="pin-btn" onclick="checkPin()">å…¥å®¤ã™ã‚‹</button>
    <div class="pin-error" id="pinError"></div>
    <div class="pin-hint">å¾“æ¥­å“¡ã®æ–¹ã¯é€šçŸ¥ã•ã‚ŒãŸPINã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚<br>ç®¡ç†è€…ã®æ–¹ã¯ç®¡ç†è€…ç”¨PINã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>
  </div>
</div>

<div class="app" id="app">
  <div class="loading" id="loading"><div class="spinner"></div><div class="load-txt" id="loadTxt">é€šä¿¡ä¸­...</div></div>
  <div class="toast" id="toast"></div>

  <header class="header">
    <div class="header-inner">
      <div class="logo">Shift<span>ç®¡ç†</span><span class="logo-role" id="roleLabel"></span></div>
      <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchView('input')">ğŸ“ ã‚·ãƒ•ãƒˆå…¥åŠ›</button>
        <button class="nav-tab admin-only" onclick="switchView('admin')" style="display:none">ğŸ“Š é›†è¨ˆ</button>
      </div>
      <div class="header-right">
        <button class="logout-btn" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
    </div>
  </header>

  <div class="period-bar">
    <div class="period-bar-inner">
      <button class="month-btn" onclick="changePeriod(-1)">â€¹</button>
      <div class="period-label" id="periodLabel"></div>
      <button class="month-btn" onclick="changePeriod(1)">â€º</button>
      <span class="period-range" id="periodRange"></span>
    </div>
  </div>

  <main class="main">
    <div id="inputView">
      <div class="select-card">
        <div class="card-title">å¾“æ¥­å“¡ã‚’é¸æŠ</div>
        <div class="emp-select-wrap">
          <select class="emp-select" id="empDD" onchange="selectEmp(this.value)">
            <option value="">-- å¾“æ¥­å“¡ã‚’é¸ã‚“ã§ãã ã•ã„ --</option>
          </select>
          <span class="emp-select-arrow">â–¼</span>
        </div>
        <div class="emp-status-row" id="empStatusRow" style="display:none">
          <span class="sdot-sm" id="empDot"></span><span id="empTxt"></span>
        </div>
      </div>
      <div class="shift-card" id="shiftCard">
        <div class="empty"><div class="ico">ğŸ‘†</div><p>ä¸Šã‹ã‚‰å¾“æ¥­å“¡ã‚’é¸æŠã—ã¦ã‚·ãƒ•ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p></div>
      </div>
    </div>

```
<div id="adminView" style="display:none">
  <div class="admin-controls">
    <button class="action-btn" onclick="exportCSV()">â¬‡ CSVå‡ºåŠ›</button>
    <button class="action-btn" onclick="reloadAdmin()">ğŸ”„ æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾—</button>
    <span style="font-size:12px;color:var(--text2);" id="adminSub"></span>
  </div>
  <div class="admin-wrap">
    <table class="admin-tbl">
      <thead><tr id="adminHead"></tr></thead>
      <tbody id="adminBody"></tbody>
    </table>
  </div>
</div>
```

  </main>
</div>

<script>
/* ================================================================
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
   â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘      â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—
   â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘      â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘      â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
   â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•   â•šâ•â•      â•šâ•â•   â•šâ•â•â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â•
   ã“ã“ã®è¨­å®šã ã‘å¤‰ãˆã‚Œã°é‹ç”¨å¤‰æ›´ã«å¯¾å¿œã§ãã¾ã™
================================================================ */

const CONFIG = {

  /* ----------------------------------------------------------
   * 1. GASæ¥ç¶šURL
   * GASãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ç™ºè¡Œã•ã‚ŒãŸURLã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã‚‹
   * ---------------------------------------------------------- */
  GAS_URL: 'YOUR_GAS_URL_HERE',

  /* ----------------------------------------------------------
   * 2. PINã‚³ãƒ¼ãƒ‰
   * å¾“æ¥­å“¡ç”¨ã¨ç®¡ç†è€…ç”¨ã‚’åˆ¥ã€…ã«è¨­å®š
   * æ•°å­—4ã€œ8æ¡ã‚’æ¨å¥¨ã€‚ç®¡ç†è€…PINã¯å¾“æ¥­å“¡ã«æ•™ãˆãªã„ã“ã¨
   * ---------------------------------------------------------- */
  PIN_EMPLOYEE: '1234',
  PIN_ADMIN:    '9999',

  /* ----------------------------------------------------------
   * 3. å¾“æ¥­å“¡ãƒªã‚¹ãƒˆ
   * è¿½åŠ : æœ«å°¾ã« 'æ–°ã—ã„åå‰', ã‚’è¿½åŠ 
   * å‰Šé™¤: è©²å½“è¡Œã‚’å‰Šé™¤ï¼ˆéå»ãƒ‡ãƒ¼ã‚¿ã¯ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«æ®‹ã‚Šã¾ã™ï¼‰
   * åå‰å¤‰æ›´: æ–‡å­—åˆ—ã‚’æ›¸ãæ›ãˆï¼ˆéå»ãƒ‡ãƒ¼ã‚¿ã¨ã®ç´ä»˜ã‘ã¯æ‰‹å‹•å¯¾å¿œãŒå¿…è¦ï¼‰
   * ---------------------------------------------------------- */
  EMPLOYEES: [
    'æ¾å²¡', 'ä½è—¤ èŠ±å­', 'å±±ç”° å¤ªéƒ', 'éˆ´æœ¨ ç¾å’²', 'ä¼Šè—¤ å¥å¤ª',
    'ä¸­æ‘ ç”±ç¾', 'å°æ— æ‹“å“‰', 'æ¸¡è¾º å¥ˆã€…', 'åŠ è—¤ ä¿®',   'æ¾æœ¬ æµ',
    'äº•ä¸Š å¤§è¼', 'æœ¨æ‘ ã•ãã‚‰','æ— æµ©äºŒ',   'æ¸…æ°´ é¦™ç¹”', 'å±±å£ æ­£æ¨¹',
  ],

  /* ----------------------------------------------------------
   * 4. ç· ã‚æ—¥è¨­å®š
   *
   * ã€ãƒ‘ã‚¿ãƒ¼ãƒ³Aã€‘æœˆåˆã€œæœˆæœ«ï¼ˆé€šå¸¸ï¼‰ã®å ´åˆ:
   *   CLOSING_DAY: 0   â† 0ã«ã™ã‚‹ã¨Aå‹•ä½œ
   *
   * ã€ãƒ‘ã‚¿ãƒ¼ãƒ³Bã€‘21æ—¥ã€œç¿Œ20æ—¥ãªã©ã®å ´åˆ:
   *   CLOSING_DAY: 20  â† ç· ã‚æ—¥ã®ã€Œæ—¥ã€ã‚’å…¥ã‚Œã‚‹
   *   ä¾‹: 21æ—¥ã€œ20æ—¥ç· ã‚ â†’ 20
   *   ä¾‹: 16æ—¥ã€œ15æ—¥ç· ã‚ â†’ 15
   *   ä¾‹: 26æ—¥ã€œ25æ—¥ç· ã‚ â†’ 25
   *
   * ç”»é¢ã®ã€ŒæœŸã€è¡¨ç¤º:
   *   PERIOD_LABEL: 'æœˆåº¦'  â†’ "2026å¹´1æœˆåº¦"
   *   PERIOD_LABEL: 'æœŸ'    â†’ "2026å¹´1æœŸ"
   * ---------------------------------------------------------- */
  CLOSING_DAY:  0,
  PERIOD_LABEL: 'æœˆåº¦',

  /* ----------------------------------------------------------
   * 5. ã‚·ãƒ•ãƒˆç¨®åˆ¥
   *
   * key:   å†…éƒ¨ã‚­ãƒ¼ï¼ˆè‹±æ•°å­—ã€‚å¤‰æ›´ã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ã¨ã®å¯¾å¿œãŒå´©ã‚Œã‚‹ã®ã§æ³¨æ„ï¼‰
   * label: ãƒœã‚¿ãƒ³ã«è¡¨ç¤ºã™ã‚‹åå‰ï¼ˆè‡ªç”±ã«å¤‰æ›´å¯ï¼‰
   * color: ãƒœã‚¿ãƒ³ã®è‰²ï¼ˆCSSã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼‰
   * bg:    ãƒœã‚¿ãƒ³ã®èƒŒæ™¯è‰²
   * countable: true=å‡ºå‹¤æ—¥æ•°ã«ã‚«ã‚¦ãƒ³ãƒˆ / false=ã‚«ã‚¦ãƒ³ãƒˆã—ãªã„
   * hasNote:   true=ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›æ¬„ã‚’è¡¨ç¤º
   *
   * â˜… è¿½åŠ ä¾‹ï¼ˆæ·±å¤œå‹¤å‹™):
   *   { key:'night', label:'æ·±å¤œ', color:'#7c3aed', bg:'#f5f3ff', countable:true,  hasNote:false },
   *
   * â˜… å‰Šé™¤: è©²å½“è¡Œã‚’ã¾ã‚‹ã”ã¨å‰Šé™¤ï¼ˆéå»ãƒ‡ãƒ¼ã‚¿ã¯æ®‹ã‚‹ï¼‰
   * ---------------------------------------------------------- */
  SHIFT_TYPES: [
    { key:'off',   label:'ä¼‘ã¿',    color:'#94a3b8', bg:'#f1f5f9', countable:false, hasNote:false },
    { key:'half',  label:'æ˜¼ä¸ŠãŒã‚Š',color:'#b45309', bg:'#fffbeb', countable:true,  hasNote:false },
    { key:'full',  label:'é€šã—',    color:'#047857', bg:'#ecfdf5', countable:true,  hasNote:false },
    { key:'other', label:'ãã®ä»–',  color:'#6d28d9', bg:'#f5f3ff', countable:true,  hasNote:true  },
  ],

  /* ----------------------------------------------------------
   * 6. ç¥æ—¥ãƒªã‚¹ãƒˆ
   *
   * å½¢å¼: 'YYYY-MM-DD': 'ç¥æ—¥å'
   * è¿½åŠ : æœ«å°¾ã«è¡Œã‚’è¿½åŠ ã™ã‚‹ã ã‘
   * 2027å¹´ä»¥é™ã«ä½¿ã†å ´åˆã¯è¿½è¨˜ã—ã¦ãã ã•ã„
   *
   * å‚è€ƒ: https://www8.cao.go.jp/chosei/shukujitsu/gaiyou.html
   * ---------------------------------------------------------- */
  HOLIDAYS: {
    '2026-01-01':'å…ƒæ—¥',         '2026-01-12':'æˆäººã®æ—¥',
    '2026-02-11':'å»ºå›½è¨˜å¿µæ—¥',   '2026-02-23':'å¤©çš‡èª•ç”Ÿæ—¥',
    '2026-03-20':'æ˜¥åˆ†ã®æ—¥',     '2026-04-29':'æ˜­å’Œã®æ—¥',
    '2026-05-03':'æ†²æ³•è¨˜å¿µæ—¥',   '2026-05-04':'ã¿ã©ã‚Šã®æ—¥',
    '2026-05-05':'ã“ã©ã‚‚ã®æ—¥',   '2026-07-20':'æµ·ã®æ—¥',
    '2026-08-11':'å±±ã®æ—¥',       '2026-09-21':'æ•¬è€ã®æ—¥',
    '2026-09-23':'ç§‹åˆ†ã®æ—¥',     '2026-10-12':'ã‚¹ãƒãƒ¼ãƒ„ã®æ—¥',
    '2026-11-03':'æ–‡åŒ–ã®æ—¥',     '2026-11-23':'å‹¤åŠ´æ„Ÿè¬ã®æ—¥',
    // 2027å¹´åˆ†ï¼ˆå¿…è¦ã«å¿œã˜ã¦è¿½åŠ ï¼‰
    // '2027-01-01':'å…ƒæ—¥',
    // '2027-01-11':'æˆäººã®æ—¥',
  },

};
/* ================================================================
   è¨­å®šã‚¨ãƒªã‚¢ ã“ã“ã¾ã§
================================================================ */


// â”€â”€ è¨­å®šã‹ã‚‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‹•çš„ç”Ÿæˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function injectStyles(){
  const styles = CONFIG.SHIFT_TYPES.map(t => `
    .sel-${t.key}{ border-color:${t.color} !important; background:${t.bg} !important; color:${t.color} !important; }
  `).join('');
  const el = document.createElement('style');
  el.textContent = styles;
  document.head.appendChild(el);
})();

// â”€â”€ çŠ¶æ…‹å¤‰æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let role = null;
let currentPeriod = { year: 2026, month: 1 }; // è¡¨ç¤ºä¸Šã®ã€ŒæœŸã€
let selectedEmp = null;
let shiftData = {};
let currentView = 'input';

// â”€â”€ ç· ã‚æ—¥ãƒ­ã‚¸ãƒƒã‚¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// currentPeriod {year, month} ã‹ã‚‰å®Ÿéš›ã®æ—¥ä»˜ç¯„å›²ã‚’è¨ˆç®—
function getPeriodRange(year, month) {
  const cd = CONFIG.CLOSING_DAY;
  if (cd === 0) {
    // æœˆåˆã€œæœˆæœ«
    const start = new Date(year, month - 1, 1);
    const end   = new Date(year, month, 0);
    return { start, end };
  } else {
    // ä¾‹: cd=20 â†’ å‰æœˆ21æ—¥ã€œå½“æœˆ20æ—¥
    const start = new Date(year, month - 2, cd + 1); // å‰æœˆ(cd+1)æ—¥
    const end   = new Date(year, month - 1, cd);     // å½“æœˆcdæ—¥
    return { start, end };
  }
}

function getPeriodDays() {
  const { start, end } = getPeriodRange(currentPeriod.year, currentPeriod.month);
  const result = [];
  const cur = new Date(start);
  while (cur <= end) {
    const ds = fmtDate(cur);
    if (cur.getDay() === 6 || cur.getDay() === 0 || CONFIG.HOLIDAYS[ds]) {
      result.push({ day: cur.getDate(), month: cur.getMonth()+1, d: new Date(cur), ds });
    }
    cur.setDate(cur.getDate() + 1);
  }
  return result;
}

function periodKey(y, m) { return `${y}-${String(m).padStart(2,'0')}`; }
function fmtDate(d) { return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }
const fmtDs = (y,m,day) => `${y}-${String(m).padStart(2,'0')}-${String(day).padStart(2,'0')}`;

function getPeriodLabel() {
  const {year:y, month:m} = currentPeriod;
  return `${y}å¹´ ${m}${CONFIG.PERIOD_LABEL}`;
}
function getPeriodRangeLabel() {
  const cd = CONFIG.CLOSING_DAY;
  const {year:y, month:m} = currentPeriod;
  if (cd === 0) {
    const lastDay = new Date(y, m, 0).getDate();
    return `${y}/${m}/1 ã€œ ${y}/${m}/${lastDay}`;
  } else {
    const { start, end } = getPeriodRange(y, m);
    return `${start.getMonth()+1}/${start.getDate()} ã€œ ${end.getMonth()+1}/${end.getDate()}`;
  }
}

// â”€â”€ PIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkPin() {
  const pin = document.getElementById('pinInput').value.trim();
  const err = document.getElementById('pinError');
  if (pin === CONFIG.PIN_ADMIN) {
    role = 'admin'; startApp();
  } else if (pin === CONFIG.PIN_EMPLOYEE) {
    role = 'employee'; startApp();
  } else {
    err.textContent = 'PINã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“';
    document.getElementById('pinInput').value = '';
    setTimeout(() => err.textContent = '', 3000);
  }
}

function startApp() {
  document.getElementById('pinScreen').style.display = 'none';
  document.getElementById('app').classList.add('show');
  const rl = document.getElementById('roleLabel');
  if (role === 'admin') {
    rl.textContent = 'ç®¡ç†è€…'; rl.className = 'logo-role admin';
    document.querySelector('.admin-only').style.display = '';
  } else {
    rl.textContent = 'å¾“æ¥­å“¡'; rl.className = 'logo-role emp';
  }
  updatePeriodBar();
  renderEmpDD();
  loadPeriodData();
}

function logout() {
  role = null; selectedEmp = null; shiftData = {};
  document.getElementById('pinInput').value = '';
  document.getElementById('pinScreen').style.display = 'flex';
  document.getElementById('app').classList.remove('show');
  document.querySelector('.admin-only').style.display = 'none';
}

// â”€â”€ GAS API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function gasReq(action, payload = {}) {
  const params = new URLSearchParams({ action, ...payload });
  const res = await fetch(`${CONFIG.GAS_URL}?${params}`);
  const json = await res.json();
  if (!json.ok) throw new Error(json.error || 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼');
  return json;
}

async function loadPeriodData() {
  const pk = periodKey(currentPeriod.year, currentPeriod.month);
  if (CONFIG.GAS_URL === 'YOUR_GAS_URL_HERE') {
    try { const d = localStorage.getItem('sl_' + pk); if(d) shiftData[pk] = JSON.parse(d); } catch(e){}
    renderEmpDD(); renderShiftInput();
    return;
  }
  showLoading('ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...');
  try {
    const res = await gasReq('getMonth', { month: pk });
    shiftData[pk] = res.data || {};
    renderEmpDD(); renderShiftInput();
    if (currentView === 'admin') renderAdmin();
  } catch(e) { showToast('âš ï¸ ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—: ' + e.message); }
  finally { hideLoading(); }
}

async function saveShifts() {
  if (!selectedEmp) return;
  const pk = periodKey(currentPeriod.year, currentPeriod.month);
  const empData = (shiftData[pk] || {})[selectedEmp] || {};
  setSyncBadge('loading','ä¿å­˜ä¸­...');
  document.querySelector('.save-btn').disabled = true;
  if (CONFIG.GAS_URL === 'YOUR_GAS_URL_HERE') {
    if(!shiftData[pk]) shiftData[pk]={};
    try { localStorage.setItem('sl_' + pk, JSON.stringify(shiftData[pk])); } catch(e){}
    setSyncBadge('ok','ä¿å­˜æ¸ˆã¿ âœ“'); document.querySelector('.save-btn').disabled = false;
    showToast('âœ… ä¿å­˜ã—ã¾ã—ãŸï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰'); renderEmpDD(); updateEmpStatus();
    return;
  }
  try {
    await gasReq('saveEmployee', { month: pk, employee: selectedEmp, data: JSON.stringify(empData) });
    setSyncBadge('ok','ä¿å­˜æ¸ˆã¿ âœ“');
    showToast('âœ… ä¿å­˜ã—ã¾ã—ãŸ'); renderEmpDD(); updateEmpStatus();
  } catch(e) {
    setSyncBadge('err','ä¿å­˜å¤±æ•—');
    showToast('âŒ ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message);
  } finally { document.querySelector('.save-btn').disabled = false; }
}

async function reloadAdmin() {
  showLoading('æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...');
  try { await loadPeriodData(); renderAdmin(); showToast('ğŸ”„ æ›´æ–°ã—ã¾ã—ãŸ'); }
  catch(e) { showToast('âš ï¸ ' + e.message); }
  finally { hideLoading(); }
}

// â”€â”€ UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchView(v) {
  currentView = v;
  document.getElementById('inputView').style.display = v==='input'?'':'none';
  document.getElementById('adminView').style.display = v==='admin'?'':'none';
  document.querySelectorAll('.nav-tab').forEach((t,i) =>
    t.classList.toggle('active',(i===0&&v==='input')||(i===1&&v==='admin')));
  if (v === 'admin') loadPeriodData().then(()=>renderAdmin());
}

function updatePeriodBar() {
  document.getElementById('periodLabel').textContent = getPeriodLabel();
  document.getElementById('periodRange').textContent = getPeriodRangeLabel();
}

function changePeriod(delta) {
  let {year:y, month:m} = currentPeriod;
  m += delta;
  if (m > 12) { m = 1; y++; }
  if (m < 1)  { m = 12; y--; }
  currentPeriod = {year:y, month:m};
  updatePeriodBar();
  // selectedEmp ã¯ãƒªã‚»ãƒƒãƒˆã—ãªã„ â†’ å¾“æ¥­å“¡é¸æŠã‚’å¼•ãç¶™ã
  loadPeriodData();
}

function renderEmpDD() {
  const pk = periodKey(currentPeriod.year, currentPeriod.month);
  const dd = document.getElementById('empDD');
  dd.innerHTML = '<option value="">-- å¾“æ¥­å“¡ã‚’é¸ã‚“ã§ãã ã•ã„ --</option>';
  CONFIG.EMPLOYEES.forEach(name => {
    const filled = Object.keys((shiftData[pk]||{})[name]||{}).length;
    const opt = document.createElement('option');
    opt.value = name; opt.textContent = name + (filled>0?' âœ“':'');
    if (name === selectedEmp) opt.selected = true;
    dd.appendChild(opt);
  });
  updateEmpStatus();
}

function updateEmpStatus() {
  const pk = periodKey(currentPeriod.year, currentPeriod.month);
  const total = getPeriodDays().length;
  const row = document.getElementById('empStatusRow');
  const dot = document.getElementById('empDot');
  const txt = document.getElementById('empTxt');
  if (!selectedEmp) { row.style.display='none'; return; }
  const filled = Object.keys((shiftData[pk]||{})[selectedEmp]||{}).length;
  row.style.display = 'flex';
  if (filled===0) { dot.className='sdot-sm'; txt.textContent='æœªå…¥åŠ›'; }
  else if (filled<total) { dot.className='sdot-sm partial'; txt.textContent=`${filled} / ${total} æ—¥ å…¥åŠ›æ¸ˆã¿`; }
  else { dot.className='sdot-sm done'; txt.textContent=`å…¨ ${total} æ—¥ å…¥åŠ›æ¸ˆã¿`; }
}

function selectEmp(name) {
  selectedEmp = name || null;
  if (selectedEmp) {
    // æœªå…¥åŠ›ã®æ—¥ã‚’ã™ã¹ã¦ã€Œä¼‘ã¿ã€ã§åŸ‹ã‚ã‚‹
    const pk = periodKey(currentPeriod.year, currentPeriod.month);
    if (!shiftData[pk]) shiftData[pk] = {};
    if (!shiftData[pk][selectedEmp]) shiftData[pk][selectedEmp] = {};
    const empData = shiftData[pk][selectedEmp];
    getPeriodDays().forEach(({ds}) => {
      if (!empData[ds]) empData[ds] = 'off';
    });
  }
  updateEmpStatus();
  renderShiftInput();
}

function getShift(ds) {
  const pk = periodKey(currentPeriod.year, currentPeriod.month);
  return ((shiftData[pk]||{})[selectedEmp]||{})[ds] || null;
}
function setShift(ds, val) {
  const pk = periodKey(currentPeriod.year, currentPeriod.month);
  if (!shiftData[pk]) shiftData[pk]={};
  if (!shiftData[pk][selectedEmp]) shiftData[pk][selectedEmp]={};
  if (val===null) delete shiftData[pk][selectedEmp][ds];
  else shiftData[pk][selectedEmp][ds] = val;
}

function getShiftType(val) {
  if (!val) return null;
  return typeof val==='object' ? val.type : val;
}

function renderShiftInput() {
  const card = document.getElementById('shiftCard');
  if (!selectedEmp) {
    card.innerHTML='<div class="empty"><div class="ico">ğŸ‘†</div><p>ä¸Šã‹ã‚‰å¾“æ¥­å“¡ã‚’é¸æŠã—ã¦ã‚·ãƒ•ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p></div>';
    return;
  }
  const days = getPeriodDays();
  const {year:y, month:m} = currentPeriod;
  const dayNames=['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];

  let html = `
    <div class="shift-card-header">
      <div class="emp-badge">${selectedEmp}
        <span style="font-size:12px;font-weight:400;color:var(--text2);margin-left:6px">${getPeriodLabel()}</span>
      </div>
      <div style="display:flex;align-items:center;gap:7px;flex-wrap:wrap;">
        <span class="sync-badge" id="syncBadge"></span>
        <button class="save-btn" onclick="saveShifts()">ğŸ’¾ ä¿å­˜</button>
      </div>
    </div>
    <table class="shift-table">
      <thead><tr><th>æ—¥ä»˜</th><th>ã‚·ãƒ•ãƒˆ</th></tr></thead>
      <tbody>`;

  days.forEach(({day, month:dm, d, ds}) => {
    const sat = d.getDay()===6, sun = d.getDay()===0, holi = CONFIG.HOLIDAYS[ds];
    const cls = sat?'is-sat':(sun||holi)?'is-holi':'';
    const cur = getShift(ds);
    const curType = getShiftType(cur);
    const curNote = (cur&&typeof cur==='object')?cur.note:'';

    const btns = CONFIG.SHIFT_TYPES.map(t => {
      const active = curType===t.key ? ` sel-${t.key}` : '';
      return `<button class="s-btn${active}" data-val="${t.key}" onclick="toggleShift('${ds}','${t.key}',this)">${t.label}</button>`;
    }).join('');

    const noteEl = CONFIG.SHIFT_TYPES.find(t=>t.key===curType&&t.hasNote)
      ? `<div class="other-wrap"><input class="other-inp" type="text" placeholder="å†…å®¹ã‚’å…¥åŠ›..." value="${curNote}" oninput="setNote('${ds}',this.value)"></div>`
      : `<div class="other-wrap" style="display:none"></div>`;

    // æœˆã‚’ã¾ãŸãå ´åˆã¯æ—¥ä»˜ã«æœˆã‚‚è¡¨ç¤º
    const dayLabel = dm!==m ? `<span style="font-size:9px;color:var(--text3);margin-right:1px">${dm}/</span>${day}` : day;

    html += `<tr data-ds="${ds}">
      <td><div class="date-cell ${cls}">
        <span class="date-num">${dayLabel}</span>
        <span class="day-pill">${dayNames[d.getDay()]}</span>
        ${holi?`<span class="holi-name">${holi}</span>`:''}
      </div></td>
      <td><div class="shift-sel">${btns}</div>${noteEl}</td>
    </tr>`;
  });

  html += `</tbody></table>`;

  // ã‚µãƒãƒªãƒ¼ãƒãƒ¼
  const pk = periodKey(currentPeriod.year, currentPeriod.month);
  const empData = (shiftData[pk]||{})[selectedEmp]||{};
  const counts = {};
  CONFIG.SHIFT_TYPES.forEach(t=>counts[t.key]=0);
  Object.values(empData).forEach(v=>{
    const k = getShiftType(v); if(counts[k]!==undefined) counts[k]++;
  });
  const totalOut = CONFIG.SHIFT_TYPES.filter(t=>t.countable).reduce((s,t)=>s+counts[t.key],0);

  html += `<div class="summary-bar">
    ${CONFIG.SHIFT_TYPES.map(t=>`
      <div class="sum-item">
        <span style="color:${t.color}">â—</span>
        <span class="sum-count" style="color:${t.color}">${counts[t.key]}</span>
        <span>${t.label}</span>
      </div>`).join('')}
    <div class="sum-item" style="margin-left:auto">
      <span style="color:var(--primary)">åˆè¨ˆå‡ºå‹¤</span>
      <span class="sum-count" style="color:var(--primary);margin:0 4px" id="totalCount">${totalOut}</span>
      <span>æ—¥</span>
    </div>
  </div>`;

  card.innerHTML = html;
}

function toggleShift(ds, val, btn) {
  const cur = getShift(ds);
  const curType = getShiftType(cur);
  const newType = curType===val ? null : val;
  const typeDef = CONFIG.SHIFT_TYPES.find(t=>t.key===newType);
  setShift(ds, newType===null ? null : (typeDef?.hasNote ? {type:newType,note:''} : newType));

  const row = btn.closest('tr');
  row.querySelectorAll('.s-btn').forEach(b=>{
    b.className = 's-btn' + (newType===b.dataset.val ? ` sel-${b.dataset.val}` : '');
  });
  const wrap = row.querySelector('.other-wrap');
  if (typeDef?.hasNote && newType) {
    wrap.style.display='flex';
    const inp=wrap.querySelector('input'); inp.value=''; inp.focus();
  } else { wrap.style.display='none'; }
  refreshSummary();
  setSyncBadge('','');
}

function setNote(ds, note) {
  const cur = getShift(ds);
  if (cur&&typeof cur==='object') { cur.note=note; setShift(ds,cur); }
  setSyncBadge('','');
}

function refreshSummary() {
  const pk = periodKey(currentPeriod.year, currentPeriod.month);
  const empData = (shiftData[pk]||{})[selectedEmp]||{};
  const counts={};
  CONFIG.SHIFT_TYPES.forEach(t=>counts[t.key]=0);
  Object.values(empData).forEach(v=>{const k=getShiftType(v);if(counts[k]!==undefined)counts[k]++;});
  const totalOut=CONFIG.SHIFT_TYPES.filter(t=>t.countable).reduce((s,t)=>s+counts[t.key],0);
  const sc = document.querySelectorAll('.sum-count');
  CONFIG.SHIFT_TYPES.forEach((t,i)=>{ if(sc[i]) sc[i].textContent=counts[t.key]; });
  const tc = document.getElementById('totalCount');
  if(tc) tc.textContent=totalOut;
}

function setSyncBadge(type, msg) {
  const b=document.getElementById('syncBadge'); if(!b) return;
  if(!type){b.textContent='';b.className='sync-badge';return;}
  b.textContent=msg; b.className='sync-badge sync-'+type;
}

// â”€â”€ ç®¡ç†è€…é›†è¨ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAdmin() {
  const days = getPeriodDays();
  const pk = periodKey(currentPeriod.year, currentPeriod.month);
  document.getElementById('adminSub').textContent = `${getPeriodLabel()}ï¼ˆ${getPeriodRangeLabel()}ï¼‰ â€” å¯¾è±¡æ—¥ ${days.length}æ—¥`;

  // ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆ
  const head = document.getElementById('adminHead');
  head.innerHTML = '<th>å¾“æ¥­å“¡å</th>'
    + CONFIG.SHIFT_TYPES.map(t=>`<th>${t.label}</th>`).join('')
    + '<th>å‡ºå‹¤åˆè¨ˆ</th><th>å…¥åŠ›çŠ¶æ³</th>';

  const body = document.getElementById('adminBody');
  body.innerHTML = '';

  CONFIG.EMPLOYEES.forEach(name => {
    const empData = (shiftData[pk]||{})[name]||{};
    const counts={};
    CONFIG.SHIFT_TYPES.forEach(t=>counts[t.key]=0);
    days.forEach(({ds})=>{
      const v=empData[ds]; if(!v) return;
      const k=getShiftType(v); if(counts[k]!==undefined) counts[k]++;
    });
    const filled = CONFIG.SHIFT_TYPES.reduce((s,t)=>s+counts[t.key],0);
    const totalOut = CONFIG.SHIFT_TYPES.filter(t=>t.countable).reduce((s,t)=>s+counts[t.key],0);
    let si='sdot-none',st='æœªå…¥åŠ›';
    if(filled===days.length){si='sdot-done';st='å…¥åŠ›æ¸ˆã¿';}
    else if(filled>0){si='sdot-partial';st=`${filled}/${days.length} æ—¥å…¥åŠ›`;}

    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${name}</td>`
      + CONFIG.SHIFT_TYPES.map(t=>`<td><span class="badge" style="background:${t.bg};color:${t.color}">${counts[t.key]}</span></td>`).join('')
      + `<td><span class="badge badge-total">${totalOut} æ—¥</span></td>`
      + `<td><span class="sdot ${si}"></span>${st}</td>`;
    body.appendChild(tr);
  });
}

// â”€â”€ CSVå‡ºåŠ› â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportCSV() {
  const days = getPeriodDays();
  const pk = periodKey(currentPeriod.year, currentPeriod.month);

  const noteKeys = CONFIG.SHIFT_TYPES.filter(t=>t.hasNote).map(t=>t.key);
  const headers = ['å¾“æ¥­å“¡å',
    ...CONFIG.SHIFT_TYPES.map(t=>t.label+'æ—¥æ•°'),
    'å‡ºå‹¤åˆè¨ˆæ—¥æ•°',
    ...(noteKeys.length>0?['ãã®ä»–ãƒ¡ãƒ¢']:[])
  ];
  const rows = [headers];

  CONFIG.EMPLOYEES.forEach(name=>{
    const empData=(shiftData[pk]||{})[name]||{};
    const counts={};
    CONFIG.SHIFT_TYPES.forEach(t=>counts[t.key]=0);
    const notes=[];
    days.forEach(({ds,day,month:dm})=>{
      const v=empData[ds]; if(!v) return;
      const k=getShiftType(v); if(counts[k]!==undefined) counts[k]++;
      if(noteKeys.includes(k)&&typeof v==='object'&&v.note) notes.push(`${dm}/${day}:${v.note}`);
    });
    const totalOut=CONFIG.SHIFT_TYPES.filter(t=>t.countable).reduce((s,t)=>s+counts[t.key],0);
    rows.push([name,
      ...CONFIG.SHIFT_TYPES.map(t=>counts[t.key]),
      totalOut,
      ...(noteKeys.length>0?[notes.join(' / ')]:[''])
    ]);
  });

  const csv=rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
  const {year:y,month:m}=currentPeriod;
  const blob=new Blob(['\uFEFF'+csv],{type:'text/csv;charset=utf-8;'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download=`ã‚·ãƒ•ãƒˆé›†è¨ˆ_${y}å¹´${m}${CONFIG.PERIOD_LABEL}.csv`;
  a.click();
  showToast('â¬‡ CSVå‡ºåŠ›ã—ã¾ã—ãŸ');
}

// â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showLoading(msg='é€šä¿¡ä¸­...'){document.getElementById('loadTxt').textContent=msg;document.getElementById('loading').classList.add('show');}
function hideLoading(){document.getElementById('loading').classList.remove('show');}
let toastTimer;
function showToast(msg){
  const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');
  clearTimeout(toastTimer);toastTimer=setTimeout(()=>t.classList.remove('show'),3000);
}
</script>

</body>
</html>